<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Paging: Binary & Decimal View</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@400;700&display=swap');

        :root {
            --bg-color: #1e1e1e;
            --box-bg: #2d2d2d;
            --text-color: #e0e0e0;
            --accent-blue: #4fc3f7;   /* Page (p) */
            --accent-green: #81c784;  /* Offset (d) */
            --accent-purple: #ba68c8; /* Frame (f) */
            --highlight-bg: #ffeb3b;
            --highlight-text: #000;
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            font-family: 'Roboto Mono', monospace;
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        h1 { margin-bottom: 5px; color: var(--accent-blue); border-bottom: 2px solid var(--accent-blue); }
        p { color: #aaa; font-size: 0.9rem; margin-bottom: 20px; }

        /* --- LAYOUT --- */
        .main-container {
            display: flex;
            gap: 40px;
            align-items: flex-start;
            flex-wrap: wrap;
            justify-content: center;
        }

        /* --- HARDWARE SECTION (Left) --- */
        .hardware-section {
            position: relative;
            background: #252526;
            padding: 40px;
            border-radius: 10px;
            border: 1px solid #444;
            width: 580px;
            height: 600px;
            display: grid;
            grid-template-columns: 240px 240px; 
            grid-template-rows: 140px 320px;
            gap: 60px 80px; 
        }

        .hw-box {
            background: var(--box-bg);
            border: 2px solid #555;
            padding: 15px;
            text-align: center;
            border-radius: 6px;
            z-index: 2;
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
            position: relative;
        }

        /* HEADING COLOR FIX: White */
        .hw-label { font-size: 0.9rem; font-weight: bold; color: #ffffff; display: block; margin-bottom: 10px; text-transform: uppercase; border-bottom: 1px solid #555; padding-bottom: 5px; }

        /* Positioning */
        #cpu-box { grid-column: 1; grid-row: 1; align-self: center; }
        #phy-addr-box { grid-column: 2; grid-row: 1; align-self: center; }
        #pt-box { grid-column: 1; grid-row: 2; align-self: start; margin-top: 10px; }
        #ram-box { grid-column: 2; grid-row: 2; align-self: start; height: 300px; overflow-y: auto; margin-top: 10px; }

        /* Address Splitting */
        .split-addr { display: flex; border: 1px solid #555; border-radius: 4px; overflow: hidden; font-size: 1.1rem;}
        .split-part { flex: 1; padding: 10px 5px; border-right: 1px solid #555; min-width: 40px; display: flex; flex-direction: column; align-items: center;}
        .split-part:last-child { border-right: none; }
        
        .bit-label { font-size: 0.7rem; margin-bottom: 2px; opacity: 0.7; }
        .val-display { font-weight: bold; }
        .binary-sub { font-size: 0.7rem; opacity: 0.8; margin-top: 2px; font-family: monospace; }

        /* Colors */
        .p-col { color: var(--accent-blue); border-color: var(--accent-blue); }
        .d-col { color: var(--accent-green); border-color: var(--accent-green); }
        .f-col { color: var(--accent-purple); border-color: var(--accent-purple); }

        /* Tables */
        .mini-table { width: 100%; border-collapse: collapse; font-size: 0.85rem; }
        .mini-table td, .mini-table th { border: 1px solid #444; padding: 6px; }
        .mini-table th { background: #333; color: #ffffff; } /* Heading White */
        .highlight-row { background-color: var(--highlight-bg) !important; color: var(--highlight-text) !important; transition: background 0.3s; }

        /* --- MODEL SECTION (Right) --- */
        .model-section {
            display: flex;
            gap: 20px;
            background: #252526;
            padding: 20px;
            border-radius: 10px;
            border: 1px solid #444;
            height: 680px;
        }

        .memory-column { display: flex; flex-direction: column; width: 180px; }
        /* Heading White */
        .col-header { text-align: center; font-weight: bold; margin-bottom: 10px; border-bottom: 2px solid #555; padding-bottom: 5px; color: #ffffff; }
        
        .mem-block { border: 1px solid #555; margin-bottom: 8px; font-size: 0.8rem; border-radius: 4px; overflow: hidden; background: #2d2d2d; }
        /* Heading White */
        .block-header { background: #333; padding: 4px; border-bottom: 1px solid #444; font-weight: bold; font-size: 0.75rem; color: #ffffff; text-align: center; }
        
        .data-line { padding: 4px 8px; border-bottom: 1px solid #444; display: flex; justify-content: space-between; }
        .active-data { background-color: var(--accent-blue); color: #000; font-weight: bold; }
        .active-phy-data { background-color: var(--accent-green); color: #000; font-weight: bold; }

        .line-num { font-family: monospace; color: #888; font-size: 0.75rem; margin-right: 5px; }

        /* --- CANVAS --- */
        #anim-canvas {
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
            pointer-events: none;
            z-index: 10;
        }

        /* --- CONTROLS --- */
        .controls {
            margin-top: 20px;
            padding: 15px 30px;
            background: #252526;
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.5);
            display: flex;
            gap: 20px;
            align-items: center;
            border-top: 4px solid var(--accent-blue);
        }

        select { padding: 8px; border-radius: 4px; border: 1px solid #555; background: #333; color: white; font-family: inherit; }

        button {
            padding: 10px 20px;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-family: inherit;
            font-weight: bold;
            font-size: 1rem;
            transition: all 0.2s;
            display: flex; align-items: center; gap: 5px;
        }
        
        #btn-next { background: var(--accent-blue); width: 170px; justify-content: center; color: #000; }
        #btn-next:hover { background: #81d4fa; transform: translateY(-2px); }
        #btn-next:disabled { background: #555; color: #888; transform: none; cursor: not-allowed; }

        #btn-reset { background: #444; color: #ccc; }
        #btn-reset:hover { background: #555; }

        .status-box {
            margin-left: 20px;
            padding: 8px 15px;
            background: #333;
            border: 1px solid #555;
            color: var(--accent-green);
            font-weight: bold;
            border-radius: 4px;
            width: 300px;
            text-align: center;
            font-size: 0.85rem;
        }

        .step-dots { display: flex; gap: 5px; margin-left: 10px; }
        .dot { width: 10px; height: 10px; border-radius: 50%; background: #444; }
        .dot.active { background: var(--accent-blue); box-shadow: 0 0 5px var(--accent-blue); }

        /* Helper for Binary Tooltip */
        .bin-addr { font-family: monospace; color: #aaa; font-size: 0.8rem; margin-top: 5px; }

    </style>
</head>
<body>

    <h1>Paging: Binary & Decimal View</h1>
    <p>Mapping Logical Addresses (p, d) to Physical Addresses (f, d).</p>

    <div class="main-container">
        
        <div class="hardware-section">
            <canvas id="anim-canvas"></canvas>

            <div class="hw-box" id="cpu-box">
                <span class="hw-label">CPU (Logical Address)</span>
                <div class="split-addr">
                    <div class="split-part p-col" id="cpu-p-part">
                        <span class="bit-label">Page (p)</span>
                        <span id="disp-p" class="val-display">0</span>
                        <span id="bin-p" class="binary-sub">00</span>
                    </div>
                    <div class="split-part d-col" id="cpu-d-part">
                        <span class="bit-label">Offset (d)</span>
                        <span id="disp-d" class="val-display">0</span>
                        <span id="bin-d" class="binary-sub">00</span>
                    </div>
                </div>
                <div class="bin-addr">Total Bits: 4 (2+2) </div>
            </div>

            <div class="hw-box" id="pt-box">
                <span class="hw-label">Page Table</span>
                <div style="max-height: 200px; overflow-y:auto;">
                    <table class="mini-table">
                        <thead><tr><th>Page (p)</th><th>Frame (f)</th></tr></thead>
                        <tbody id="pt-body"></tbody>
                    </table>
                </div>
            </div>

            <div class="hw-box" id="phy-addr-box">
                <span class="hw-label">Physical Address Register</span>
                <div class="split-addr" style="border-color: #555;">
                    <div class="split-part f-col" id="phy-f-part">
                        <span class="bit-label">Frame (f)</span>
                        <span id="disp-f" class="val-display">-</span>
                        <span id="bin-f" class="binary-sub">---</span>
                    </div>
                    <div class="split-part d-col" id="phy-d-part">
                        <span class="bit-label">Offset (d)</span>
                        <span id="disp-d-phy" class="val-display">-</span>
                        <span id="bin-d-phy" class="binary-sub">--</span>
                    </div>
                </div>
                <div class="bin-addr">Total Bits: 5 (3+2)</div>
            </div>

            <div class="hw-box" id="ram-box">
                <span class="hw-label">Physical Memory (RAM)</span>
                <table class="mini-table">
                    <thead><tr><th>Frame No.</th><th>Content</th></tr></thead>
                    <tbody id="ram-body"></tbody>
                </table>
            </div>
        </div>

        <div class="model-section">
            <div class="memory-column">
                <div class="col-header">Logical Memory</div>
                <div style="overflow-y:auto; flex:1;" id="logical-view"></div>
            </div>

            <div class="memory-column">
                <div class="col-header">Physical Memory</div>
                <div style="overflow-y:auto; flex:1;" id="physical-view"></div>
            </div>
        </div>
    </div>

    <div class="controls">
        <div>
            <label>Page (p):</label>
            <select id="sel-p" onchange="resetSim()">
                <option value="0">Page 0 (00)</option>
                <option value="1">Page 1 (01)</option>
                <option value="2">Page 2 (10)</option>
                <option value="3">Page 3 (11)</option>
            </select>
        </div>
        <div>
            <label>Offset (d):</label>
            <select id="sel-d" onchange="resetSim()">
                <option value="0">Line 0 (00)</option>
                <option value="1">Line 1 (01)</option>
                <option value="2">Line 2 (10)</option>
                <option value="3">Line 3 (11)</option>
            </select>
        </div>
        
        <button onclick="nextStep()" id="btn-next">Next Step &#8594;</button>
        <button onclick="resetSim()" id="btn-reset">Reset</button>

        <div class="step-dots" id="dots-container">
            <div class="dot active"></div><div class="dot"></div><div class="dot"></div><div class="dot"></div><div class="dot"></div>
        </div>

        <div class="status-box" id="status-msg">Waiting to Start...</div>
    </div>

    <script>
        // --- CONFIG ---
        // 2 bits for Page (4 pages), 2 bits for Offset (4 lines), 3 bits for Frame (8 frames)
        const logicalData = [
            ['Data A', 'Data B', 'Data C', 'Data D'], 
            ['Data E', 'Data F', 'Data G', 'Data H'], 
            ['Data I', 'Data J', 'Data K', 'Data L'], 
            ['Data M', 'Data N', 'Data O', 'Data P']
        ];
        let pageTable = [];
        let currentStep = 0;
        let isAnimating = false;

        const canvas = document.getElementById('anim-canvas');
        const ctx = canvas.getContext('2d');

        // Helper: Decimal to Binary String
        function toBin(num, bits) {
            return num.toString(2).padStart(bits, '0');
        }

        // --- INIT ---
        function init() {
            let usedFrames = new Set();
            pageTable = [];
            // Randomly assign frames
            for(let i=0; i<4; i++) {
                let f; do { f = Math.floor(Math.random() * 8); } while(usedFrames.has(f));
                usedFrames.add(f);
                pageTable.push(f);
            }
            renderHardwareTables();
            renderContentModel();
            resizeCanvas();
            updateUIState();
        }

        function renderHardwareTables() {
            const ptBody = document.getElementById('pt-body');
            ptBody.innerHTML = '';
            pageTable.forEach((f, p) => {
                ptBody.innerHTML += `
                    <tr id="hw-pt-row-${p}">
                        <td><span style="color:var(--accent-blue)">${p}</span> (${toBin(p,2)})</td>
                        <td><span style="color:var(--accent-purple)">${f}</span> (${toBin(f,3)})</td>
                    </tr>`;
            });

            const ramBody = document.getElementById('ram-body');
            ramBody.innerHTML = '';
            for(let f=0; f<8; f++) {
                let pIdx = pageTable.indexOf(f);
                let content = (pIdx !== -1) ? `<b>Page ${pIdx}</b>` : `<span style="color:#555">Free</span>`;
                ramBody.innerHTML += `
                    <tr id="hw-ram-row-${f}">
                        <td>Frame ${f} <span style="color:#777">(${toBin(f,3)})</span></td>
                        <td>${content}</td>
                    </tr>`;
            }
        }

        function renderContentModel() {
            const logContainer = document.getElementById('logical-view');
            logContainer.innerHTML = '';
            logicalData.forEach((lines, pIdx) => {
                // Modified Header: Includes Decimal and Binary
                let html = `<div class="mem-block"><div class="block-header">Page ${pIdx} (Bin: ${toBin(pIdx, 2)})</div>`;
                lines.forEach((char, offset) => {
                    // Modified Line: Includes Decimal and Binary
                    html += `<div class="data-line" id="log-line-${pIdx}-${offset}">
                                <span class="line-num">${offset} (${toBin(offset,2)})</span>
                                <span>${char}</span>
                             </div>`;
                });
                html += `</div>`;
                logContainer.innerHTML += html;
            });

            const phyContainer = document.getElementById('physical-view');
            phyContainer.innerHTML = '';
            for(let f=0; f<8; f++) {
                let pIdx = pageTable.indexOf(f);
                // Modified Header: Includes Decimal and Binary
                let html = `<div class="mem-block"><div class="block-header">Frame ${f} (Bin: ${toBin(f,3)})</div>`;
                if(pIdx !== -1) {
                    logicalData[pIdx].forEach((char, offset) => {
                        // Modified Line: Includes Decimal and Binary
                        html += `<div class="data-line" id="phy-line-${f}-${offset}">
                                    <span class="line-num">${offset} (${toBin(offset,2)})</span>
                                    <span>${char}</span>
                                 </div>`;
                    });
                } else {
                    html += `<div style="padding:5px; color:#555; text-align:center;">- Empty -</div>`;
                }
                html += `</div>`;
                phyContainer.innerHTML += html;
            }
        }

        // --- DRAWING HELPERS ---
        function getAnchor(id, side) {
            const el = document.getElementById(id);
            const root = document.querySelector('.hardware-section');
            const r = el.getBoundingClientRect();
            const c = root.getBoundingClientRect();
            const relLeft = r.left - c.left;
            const relTop = r.top - c.top;
            
            if(side === 'top') return { x: relLeft + r.width/2, y: relTop };
            if(side === 'bottom') return { x: relLeft + r.width/2, y: relTop + r.height };
            if(side === 'left') return { x: relLeft, y: relTop + r.height/2 };
            if(side === 'right') return { x: relLeft + r.width, y: relTop + r.height/2 };
        }

        async function drawPolyline(points, color) {
            return new Promise(resolve => {
                let totalLength = 0;
                for(let i=0; i<points.length-1; i++) {
                    const dx = points[i+1].x - points[i].x;
                    const dy = points[i+1].y - points[i].y;
                    totalLength += Math.sqrt(dx*dx + dy*dy);
                }

                const speed = 4; 
                let walked = 0;

                function step() {
                    walked += speed;
                    if(walked > totalLength) walked = totalLength;

                    let currentDist = walked;
                    ctx.beginPath();
                    ctx.moveTo(points[0].x, points[0].y);
                    
                    for(let i=0; i<points.length-1; i++) {
                        const p1 = points[i];
                        const p2 = points[i+1];
                        const dx = p2.x - p1.x;
                        const dy = p2.y - p1.y;
                        const dist = Math.sqrt(dx*dx + dy*dy);

                        if(currentDist <= dist) {
                            const ratio = currentDist / dist;
                            ctx.lineTo(p1.x + dx * ratio, p1.y + dy * ratio);
                            break;
                        } else {
                            ctx.lineTo(p2.x, p2.y);
                            currentDist -= dist;
                        }
                    }
                    ctx.strokeStyle = color;
                    ctx.lineWidth = 3;
                    ctx.lineCap = 'round';
                    ctx.lineJoin = 'round';
                    ctx.stroke();

                    if(walked < totalLength) requestAnimationFrame(step);
                    else resolve();
                }
                step();
            });
        }

        // --- STEP MACHINE ---
        async function nextStep() {
            if(isAnimating) return;
            isAnimating = true;
            document.getElementById('btn-next').disabled = true;
            document.getElementById('sel-p').disabled = true;
            document.getElementById('sel-d').disabled = true;

            const p = parseInt(document.getElementById('sel-p').value);
            const d = parseInt(document.getElementById('sel-d').value);
            const f = pageTable[p];

            // Update CPU box display
            document.getElementById('disp-p').innerText = p;
            document.getElementById('bin-p').innerText = toBin(p, 2);
            document.getElementById('disp-d').innerText = d;
            document.getElementById('bin-d').innerText = toBin(d, 2);

            switch(currentStep) {
                case 0:
                    // Step 1: Extract P
                    setStatus(`1. CPU generates Address. Extract Page p=${p} (Bin: ${toBin(p,2)})`);
                    highlight(`log-line-${p}-${d}`, 'active-data');
                    
                    const cpuP = getAnchor('cpu-p-part', 'bottom');
                    const ptTop = getAnchor('pt-box', 'top');
                    
                    await drawPolyline([
                        {x: cpuP.x, y: cpuP.y},
                        {x: cpuP.x, y: ptTop.y}
                    ], '#4fc3f7'); // Blue
                    
                    currentStep++;
                    break;

                case 1:
                    // Step 2: Lookup F
                    setStatus(`2. Page Table maps Page ${p} (${toBin(p,2)}) -> Frame ${f} (${toBin(f,3)})`);
                    highlight(`hw-pt-row-${p}`, 'highlight-row');
                    
                    await new Promise(r => setTimeout(r, 400)); 

                    const ptTopRef = getAnchor('pt-box', 'top'); 
                    const phyF = getAnchor('phy-f-part', 'bottom');
                    const midY = (getAnchor('cpu-box', 'bottom').y + ptTopRef.y) / 2;

                    await drawPolyline([
                        {x: ptTopRef.x + 40, y: ptTopRef.y}, 
                        {x: ptTopRef.x + 40, y: midY},       
                        {x: phyF.x, y: midY},                
                        {x: phyF.x, y: phyF.y}               
                    ], '#ba68c8'); // Purple

                    document.getElementById('disp-f').innerText = f;
                    document.getElementById('bin-f').innerText = toBin(f, 3);
                    currentStep++;
                    break;

                case 2:
                    // Step 3: Transfer D
                    setStatus(`3. Offset d=${d} (${toBin(d,2)}) remains unchanged.`);
                    
                    const cpuD = getAnchor('cpu-d-part', 'top');
                    const phyD = getAnchor('phy-d-part', 'top');
                    const archHeight = cpuD.y - 50; 
                    
                    await drawPolyline([
                        {x: cpuD.x, y: cpuD.y},
                        {x: cpuD.x, y: archHeight},
                        {x: phyD.x, y: archHeight},
                        {x: phyD.x, y: phyD.y}
                    ], '#81c784'); // Green

                    document.getElementById('disp-d-phy').innerText = d;
                    document.getElementById('bin-d-phy').innerText = toBin(d, 2);
                    currentStep++;
                    break;

                case 3:
                    // Step 4: Access RAM
                    setStatus(`4. Physical Address: Frame ${toBin(f,3)} | Offset ${toBin(d,2)}`);
                    const phyBot = getAnchor('phy-addr-box', 'bottom');
                    const ramTop = getAnchor('ram-box', 'top');
                    
                    await drawPolyline([
                        {x: phyBot.x, y: phyBot.y},
                        {x: phyBot.x, y: ramTop.y}
                    ], '#aaa');
                    
                    highlight(`hw-ram-row-${f}`, 'highlight-row');
                    highlight(`phy-line-${f}-${d}`, 'active-phy-data');
                    
                    // Final Status update
                    document.getElementById('status-msg').innerHTML = 
                        `Data Found at Address <br> <span style="color:#fff">Binary: ${toBin(f,3)}${toBin(d,2)}</span>`;
                    currentStep++;
                    break;
            }

            isAnimating = false;
            updateUIState();
        }

        function resetSim() {
            currentStep = 0;
            ctx.clearRect(0,0, canvas.width, canvas.height);
            document.querySelectorAll('.active-data, .active-phy-data, .highlight-row').forEach(el => {
                el.classList.remove('active-data', 'active-phy-data', 'highlight-row');
            });
            
            // Reset Displays
            document.getElementById('disp-p').innerText = document.getElementById('sel-p').value;
            document.getElementById('bin-p').innerText = toBin(parseInt(document.getElementById('sel-p').value), 2);
            
            document.getElementById('disp-d').innerText = document.getElementById('sel-d').value;
            document.getElementById('bin-d').innerText = toBin(parseInt(document.getElementById('sel-d').value), 2);

            document.getElementById('disp-f').innerText = '-';
            document.getElementById('bin-f').innerText = '---';
            
            document.getElementById('disp-d-phy').innerText = '-';
            document.getElementById('bin-d-phy').innerText = '--';

            document.getElementById('sel-p').disabled = false;
            document.getElementById('sel-d').disabled = false;
            
            setStatus("Ready to Start");
            updateUIState();
        }

        function setStatus(msg) { document.getElementById('status-msg').innerHTML = msg; }

        function highlight(id, className) {
            const el = document.getElementById(id);
            if(el) { el.scrollIntoView({behavior:'smooth', block:'center'}); el.classList.add(className); }
        }

        function updateUIState() {
            const btn = document.getElementById('btn-next');
            if(currentStep >= 4) {
                btn.innerHTML = "Finished";
                btn.disabled = true;
            } else {
                btn.innerHTML = "Next Step &#8594;";
                btn.disabled = false;
            }
            const dots = document.querySelectorAll('.dot');
            dots.forEach((d, i) => {
                if(i <= currentStep) d.classList.add('active');
                else d.classList.remove('active');
            });
        }

        function resizeCanvas() {
            const c = document.querySelector('.hardware-section');
            canvas.width = c.offsetWidth;
            canvas.height = c.offsetHeight;
        }
        window.onresize = resizeCanvas;
        window.onload = init;

    </script>
</body>
</html>